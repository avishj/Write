name: Setup JS Environment
description: Setup Bun, cache deps, and optionally install Playwright browsers

inputs:
  playwright:
    description: Whether to install Playwright browsers
    required: false
    default: "false"

runs:
  using: composite
  steps:
    - name: Setup Bun
      uses: oven-sh/setup-bun@3d267786b128fe76c2f16a390aa2448b815359f3 # v2.1.2
      with:
        bun-version: "1.3.x"

    - name: Cache Bun dependencies
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
      with:
        path: ~/.bun/install/cache
        key: bun-${{ runner.os }}-${{ hashFiles('bun.lock') }}
        restore-keys: bun-${{ runner.os }}-

    - name: Install dependencies
      shell: bash
      run: bun install --frozen-lockfile --ignore-scripts

    - name: Cache Playwright browsers
      if: inputs.playwright == 'true'
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5.0.3
      with:
        path: ~/.cache/ms-playwright
        key: playwright-${{ runner.os }}-${{ hashFiles('bun.lock') }}
        restore-keys: playwright-${{ runner.os }}-

    - name: Install Playwright browsers
      if: inputs.playwright == 'true'
      shell: bash
      run: bunx playwright install --with-deps chromium firefox
